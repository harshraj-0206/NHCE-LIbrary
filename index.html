<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NHCE Library</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      transition: background 0.3s, color 0.3s;
    }
    :root {
      --bg: #ffffff;
      --text: #000000;
      --card-bg: #f7f7f7;
    }
    body.dark {
      --bg: #121212;
      --text: #f0f0f0;
      --card-bg: #1e1e1e;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--card-bg);
      padding: 10px 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    header h1 {
      display: flex;
      align-items: center;
      font-size: 1.2rem;
      margin: 0;
      font-weight: 600;
    }
    header h1::before {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      background: royalblue;
      border-radius: 4px;
      margin-right: 8px;
    }
    header div {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    button, input[type="text"], input[type="password"] {
      font-size: 14px;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: royalblue;
      color: white;
      border: none;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    button:hover {
      opacity: 0.9;
    }
    main {
      max-width: 900px;
      margin: 40px auto;
      padding: 0 20px;
    }
    .card {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
      display: flex;
      flex-direction: column;
      gap: 5px;
      word-wrap: break-word;
    }
    .card-title {
      font-weight: 600;
      font-size: 1rem;
    }
    .card-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 5px;
    }
    .center {
      text-align: center;
      margin-top: 30px;
    }
    .dark-toggle {
      cursor: pointer;
    }
    #loginModal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    #loginBox {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 320px;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <h1>NHCE Library</h1>
    <div>
      <label><input type="checkbox" id="darkMode"> Dark</label>
      <button id="exportBtn">Export</button>
      <button id="importBtn">Import</button>
      <button id="shareBtn">Shareable Link</button>
    </div>
  </header>

  <main>
    <div class="center">
      <h2>Welcome To NHCE Library!</h2>
      <p id="roleInfo"></p>
    </div>

    <section id="manageSection" style="display:none;">
      <h3>Manage Folders</h3>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <input type="text" id="folderName" placeholder="Subject / Folder name">
        <input type="text" id="folderLink" placeholder="Google Drive folder link (must be public)">
        <button id="addBtn">Add</button>
      </div>
      <p style="font-size:0.85rem;opacity:0.8;">Tip: Use the public 'share' link of your Drive folder.</p>
      <div id="foldersContainer"></div>
    </section>
  </main>

  <div id="loginModal">
    <div id="loginBox">
      <h3>Login</h3>
      <p>Are you a Student or Librarian?</p>
      <button onclick="loginAs('student')">Student</button>
      <button onclick="loginAs('librarian')">Librarian</button>
      <div id="librarianLogin" style="display:none; margin-top:15px;">
        <input type="text" id="libUser" placeholder="Username"><br><br>
        <input type="password" id="libPass" placeholder="Password"><br><br>
        <button onclick="doLibrarianLogin()">Login</button>
      </div>
    </div>
  </div>

  <script>
    const foldersContainer = document.getElementById('foldersContainer');
    const folderName = document.getElementById('folderName');
    const folderLink = document.getElementById('folderLink');
    const addBtn = document.getElementById('addBtn');
    const manageSection = document.getElementById('manageSection');
    const roleInfo = document.getElementById('roleInfo');
    const darkMode = document.getElementById('darkMode');
    const loginModal = document.getElementById('loginModal');
    const libUser = document.getElementById('libUser');
    const libPass = document.getElementById('libPass');
    const librarianLogin = document.getElementById('librarianLogin');

    let folders = JSON.parse(localStorage.getItem('nhce_folders')||'[]');
    let librarian = JSON.parse(localStorage.getItem('nhce_librarian')||'null');
    let role = null;

    function saveData(){
      localStorage.setItem('nhce_folders', JSON.stringify(folders));
      localStorage.setItem('nhce_librarian', JSON.stringify(librarian));
    }

    function renderFolders(){
      foldersContainer.innerHTML = '';
      folders.forEach((f, i)=>{
        const div = document.createElement('div');
        div.className='card';
        div.innerHTML = `
          <div class='card-title'>${f.name}</div>
          <a href='${f.link}' target='_blank'>${f.link}</a>
          <div class='card-actions'>
            <button onclick="openFolder('${f.link}')">Open</button>
            ${role==='librarian' ? `
              <button onclick="renameFolder(${i})">Rename</button>
              <button onclick="editLink(${i})">Edit Link</button>
              <button onclick="deleteFolder(${i})">Delete</button>
            ` : ''}
          </div>
        `;
        foldersContainer.appendChild(div);
      });
    }

    function openFolder(link){ window.open(link, '_blank'); }
    function renameFolder(i){
      const name = prompt('New folder name:', folders[i].name);
      if(name){ folders[i].name=name; saveData(); renderFolders(); }
    }
    function editLink(i){
      const link = prompt('New Google Drive link:', folders[i].link);
      if(link){ folders[i].link=link; saveData(); renderFolders(); }
    }
    function deleteFolder(i){
      if(confirm('Delete this folder?')){ folders.splice(i,1); saveData(); renderFolders(); }
    }

    addBtn.onclick = ()=>{
      if(folderName.value && folderLink.value){
        folders.push({name:folderName.value, link:folderLink.value});
        folderName.value=''; folderLink.value='';
        saveData(); renderFolders();
      }
    }

    // login logic
    function loginAs(type){
      if(type==='student'){
        role='student'; loginModal.style.display='none';
        roleInfo.textContent='You are logged in as Student.';
        renderFolders();
      } else {
        librarianLogin.style.display='block';
      }
    }

    function doLibrarianLogin(){
      if(!librarian){
        // first time setup
        librarian = {user: libUser.value, pass: libPass.value};
        saveData();
        alert('Librarian account created.');
        role='librarian'; loginModal.style.display='none';
        roleInfo.textContent='Role: Librarian';
        manageSection.style.display='block';
        renderFolders();
      } else {
        if(libUser.value===librarian.user && libPass.value===librarian.pass){
          role='librarian'; loginModal.style.display='none';
          roleInfo.textContent='Role: Librarian';
          manageSection.style.display='block';
          renderFolders();
        } else {
          alert('Invalid credentials');
        }
      }
    }

    // dark mode
    darkMode.checked = localStorage.getItem('nhce_dark')==='1';
    if(darkMode.checked) document.body.classList.add('dark');
    darkMode.onchange = ()=>{
      document.body.classList.toggle('dark', darkMode.checked);
      localStorage.setItem('nhce_dark', darkMode.checked?'1':'0');
    };

    // Export / Import
    document.getElementById('exportBtn').onclick = ()=>{
      const data = {folders, librarian};
      const blob = new Blob([JSON.stringify(data)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'nhce_library_export.json';
      a.click();
    };
    document.getElementById('importBtn').onclick = ()=>{
      const input = document.createElement('input');
      input.type='file';
      input.accept='.json';
      input.onchange = e=>{
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = ev=>{
          const data = JSON.parse(ev.target.result);
          folders=data.folders||[];
          librarian=data.librarian||librarian;
          saveData(); renderFolders();
        };
        reader.readAsText(file);
      };
      input.click();
    };

    // Shareable Link
    document.getElementById('shareBtn').onclick = ()=>{
      const encoded = encodeURIComponent(btoa(JSON.stringify(folders)));
      const url = `${location.origin}${location.pathname}?data=${encoded}`;
      navigator.clipboard.writeText(url).then(()=>{
        alert('Sharable link copied to clipboard!');
      });
    };

    // Load shared data
    const params = new URLSearchParams(location.search);
    if(params.has('data')){
      try {
        folders = JSON.parse(atob(decodeURIComponent(params.get('data'))));
        saveData();
      } catch(e){ console.error(e); }
    }

    renderFolders();
  </script>
</body>
</html>
